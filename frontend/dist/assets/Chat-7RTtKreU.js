import{f as me,l as fe,n as xe,j as e,c as be,p as ve,G as je,u as Se,r,B as u,m as we,q as T,V as P,H as d,T as c,M as Z,s as z,t as ee,a as F,v as ye,w as Re,x as ae,y as _,A as ke,z as W,I as C,C as Ne,D as Le,E as Ie,S as Ee,J as Te,K as ze}from"./index-CC3hQ2IX.js";import{u as Ce,a as G}from"./index-CuQY84aL.js";import{I as Be}from"./input-Du_i7Hi_.js";import"./use-form-control-D6BAIuz9.js";const V=me(function(f,g){const R=fe("Badge",f),{className:L,...k}=xe(f);return e.jsx(be.span,{ref:g,className:ve("chakra-badge",f.className),...k,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...R}})});V.displayName="Badge";function Ve(t){return je({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M6 12.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5M3 8.062C3 6.76 4.235 5.765 5.53 5.886a26.6 26.6 0 0 0 4.94 0C11.765 5.765 13 6.76 13 8.062v1.157a.93.93 0 0 1-.765.935c-.845.147-2.34.346-4.235.346s-3.39-.2-4.235-.346A.93.93 0 0 1 3 9.219zm4.542-.827a.25.25 0 0 0-.217.068l-.92.9a25 25 0 0 1-1.871-.183.25.25 0 0 0-.068.495c.55.076 1.232.149 2.02.193a.25.25 0 0 0 .189-.071l.754-.736.847 1.71a.25.25 0 0 0 .404.062l.932-.97a25 25 0 0 0 1.922-.188.25.25 0 0 0-.068-.495c-.538.074-1.207.145-1.98.189a.25.25 0 0 0-.166.076l-.754.785-.842-1.7a.25.25 0 0 0-.182-.135"},child:[]},{tag:"path",attr:{d:"M8.5 1.866a1 1 0 1 0-1 0V3h-2A4.5 4.5 0 0 0 1 7.5V8a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1v1a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-1a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1v-.5A4.5 4.5 0 0 0 10.5 3h-2zM14 7.5V13a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7.5A3.5 3.5 0 0 1 5.5 4h5A3.5 3.5 0 0 1 14 7.5"},child:[]}]})(t)}const B=we(u),O="http://localhost:5001",N=[{code:"en-US",name:"English (US)",flag:"ðŸ‡ºðŸ‡¸",voiceName:"en-US"},{code:"en-GB",name:"English (UK)",flag:"ðŸ‡¬ðŸ‡§",voiceName:"en-GB"},{code:"es-ES",name:"Spanish (Spain)",flag:"ðŸ‡ªðŸ‡¸",voiceName:"es-ES"},{code:"es-MX",name:"Spanish (Mexico)",flag:"ðŸ‡²ðŸ‡½",voiceName:"es-MX"},{code:"fr-FR",name:"French",flag:"ðŸ‡«ðŸ‡·",voiceName:"fr-FR"},{code:"de-DE",name:"German",flag:"ðŸ‡©ðŸ‡ª",voiceName:"de-DE"},{code:"it-IT",name:"Italian",flag:"ðŸ‡®ðŸ‡¹",voiceName:"it-IT"},{code:"pt-BR",name:"Portuguese (Brazil)",flag:"ðŸ‡§ðŸ‡·",voiceName:"pt-BR"},{code:"pt-PT",name:"Portuguese (Portugal)",flag:"ðŸ‡µðŸ‡¹",voiceName:"pt-PT"},{code:"ru-RU",name:"Russian",flag:"ðŸ‡·ðŸ‡º",voiceName:"ru-RU"},{code:"ja-JP",name:"Japanese",flag:"ðŸ‡¯ðŸ‡µ",voiceName:"ja-JP"},{code:"ko-KR",name:"Korean",flag:"ðŸ‡°ðŸ‡·",voiceName:"ko-KR"},{code:"zh-CN",name:"Chinese (Simplified)",flag:"ðŸ‡¨ðŸ‡³",voiceName:"zh-CN"},{code:"zh-TW",name:"Chinese (Traditional)",flag:"ðŸ‡¹ðŸ‡¼",voiceName:"zh-TW"},{code:"hi-IN",name:"Hindi",flag:"ðŸ‡®ðŸ‡³",voiceName:"hi-IN"},{code:"ar-SA",name:"Arabic",flag:"ðŸ‡¸ðŸ‡¦",voiceName:"ar-SA"},{code:"nl-NL",name:"Dutch",flag:"ðŸ‡³ðŸ‡±",voiceName:"nl-NL"},{code:"pl-PL",name:"Polish",flag:"ðŸ‡µðŸ‡±",voiceName:"pl-PL"},{code:"tr-TR",name:"Turkish",flag:"ðŸ‡¹ðŸ‡·",voiceName:"tr-TR"},{code:"sv-SE",name:"Swedish",flag:"ðŸ‡¸ðŸ‡ª",voiceName:"sv-SE"}],Me=()=>{const t=navigator.language||navigator.userLanguage||"en-US";let f=N.find(g=>g.code===t);if(!f){const g=t.split("-")[0];f=N.find(R=>R.code.startsWith(g))}return f||N[0]},Fe=()=>{const{t}=Se("common"),f=()=>{const a=localStorage.getItem("hm-language");if(a){const o=N.find(s=>s.code===a);if(o)return o}return Me()},[g,R]=r.useState(null),[L,k]=r.useState([]),[M,U]=r.useState(""),[A,K]=r.useState(!1),[H,J]=r.useState(!1),[$,te]=r.useState([]),[l,I]=r.useState(!1),[E,S]=r.useState(!1),[x,se]=r.useState(!0),[n,re]=r.useState(f()),[q,oe]=r.useState([]),Q=r.useRef(null),i=r.useRef(null),h=r.useRef(null),b=r.useRef(null),[w,X]=r.useState(localStorage.getItem("hm-tts-engine")||"eleven"),y=Ce(),ne=()=>{var a;(a=Q.current)==null||a.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{ne()},[L]),r.useEffect(()=>{ue(),ie(),localStorage.getItem("hm-language-notification")||(y({title:t("chat.toasts.languageDetectedTitle",{flag:n.flag,name:n.name}),description:t("chat.toasts.languageDetectedDesc"),status:"info",duration:5e3,isClosable:!0,position:"top"}),localStorage.setItem("hm-language-notification","true"))},[]),r.useEffect(()=>{localStorage.setItem("hm-language",n.code)},[n]),r.useEffect(()=>{localStorage.setItem("hm-tts-engine",w)},[w]);const ie=()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const a=window.SpeechRecognition||window.webkitSpeechRecognition;i.current=new a,i.current.continuous=!1,i.current.interimResults=!1,i.current.lang=n.code,i.current.onstart=()=>{I(!0)},i.current.onresult=o=>{const s=o.results[0][0].transcript;U(s),I(!1)},i.current.onerror=o=>{console.error("Speech recognition error:",o.error),I(!1),o.error!=="no-speech"&&y({title:t("chat.toasts.voiceInputErrorTitle"),description:t("chat.toasts.voiceInputErrorDesc"),status:"error",duration:3e3,isClosable:!0})},i.current.onend=()=>{I(!1)}}if("speechSynthesis"in window){h.current=window.speechSynthesis;const a=()=>{const o=h.current.getVoices();oe(o)};a(),h.current.onvoiceschanged!==void 0&&(h.current.onvoiceschanged=a)}};r.useEffect(()=>{i.current&&(i.current.lang=n.code)},[n]);const ce=()=>{if(i.current)try{i.current.start()}catch(a){console.error("Error starting recognition:",a)}else y({title:t("chat.toasts.voiceNotSupportedTitle"),description:t("chat.toasts.voiceNotSupportedDesc"),status:"warning",duration:3e3,isClosable:!0})},le=()=>{i.current&&i.current.stop()},Y=async a=>{if(!x||!a)return;if(b.current){try{b.current.pause()}catch{}try{URL.revokeObjectURL(b.current.src)}catch{}b.current=null}h.current&&h.current.cancel();const o=()=>{if(h.current)try{const s=new SpeechSynthesisUtterance(a);s.rate=.9,s.pitch=1,s.volume=1,s.lang=n.code;const j=q.length>0?q:h.current.getVoices(),v=j.filter(m=>m.lang.startsWith(n.code.split("-")[0])),p=v.find(m=>m.name.includes("Google")||m.name.includes("Natural")||m.name.includes("Enhanced")||m.name.includes("Premium"))||v.find(m=>m.lang===n.code)||v[0]||j[0];p&&(s.voice=p),s.onstart=()=>S(!0),s.onend=()=>S(!1),s.onerror=()=>S(!1),h.current.speak(s)}catch(s){console.error("Browser TTS failed:",s)}};if(w==="browser")return o();try{const j=(await G.post(`${O}/api/tts/eleven`,{text:a},{responseType:"blob"})).data,v=URL.createObjectURL(j),p=new Audio(v);b.current=p,p.onplay=()=>S(!0),p.onended=()=>{S(!1);try{URL.revokeObjectURL(v)}catch{}},p.onerror=()=>{S(!1);try{URL.revokeObjectURL(v)}catch{}},await p.play();return}catch(s){return console.warn("ElevenLabs playback failed; falling back to browser TTS:",(s==null?void 0:s.message)||s),o()}},de=()=>{if(b.current){try{b.current.pause()}catch{}try{URL.revokeObjectURL(b.current.src)}catch{}b.current=null}h.current&&h.current.cancel(),S(!1)},he=()=>{x&&E&&de(),se(!x)},ue=async()=>{try{K(!0);const a=await G.post(`${O}/api/ai-chat/session/start`);R(a.data.sessionId),k([a.data.message])}catch(a){console.error("Error starting chat session:",a),y({title:t("chat.toasts.connectionErrorTitle"),description:t("chat.toasts.connectionErrorDesc"),status:"error",duration:5e3,isClosable:!0})}finally{K(!1)}},D=async(a=M)=>{if(!a.trim()||!g)return;const o={role:"user",content:a,timestamp:new Date};k(s=>[...s,o]),U(""),J(!0);try{const s=await G.post(`${O}/api/ai-chat/message`,{sessionId:g,message:a,language:n.name}),{message:j,quickReplies:v,crisis:p}=s.data;k(m=>[...m,j]),te(v||[]),x&&j.content&&Y(j.content),p&&y({title:"Support Resources Available",description:"If you're in crisis, please reach out: National Suicide Prevention Lifeline: 988",status:"warning",duration:1e4,isClosable:!0,icon:e.jsx(ze,{})})}catch(s){console.error("Error sending message:",s),y({title:t("chat.toasts.messageFailedTitle"),description:t("chat.toasts.messageFailedDesc"),status:"error",duration:3e3,isClosable:!0})}finally{J(!1)}},ge=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),D())},pe=a=>{D(a)};return e.jsxs(u,{h:"100vh",bg:"var(--hm-color-bg)",position:"relative",overflow:"hidden",children:[e.jsx(B,{position:"absolute",top:"-20%",left:"-10%",w:"80%",h:"80%",className:"hm-bg-gradient-pink",animate:{opacity:[.4,.7,.4]},transition:{duration:8,repeat:1/0}}),e.jsx(B,{position:"absolute",bottom:"-20%",right:"-10%",w:"70%",h:"70%",className:"hm-bg-gradient-blue",animate:{opacity:[.4,.7,.4]},transition:{duration:8,repeat:1/0}}),e.jsxs(T,{direction:"column",h:"calc(100vh - 80px)",position:"relative",zIndex:1,mt:"80px",children:[e.jsxs(T,{align:"center",justify:"space-between",px:6,py:6,mt:"80px",borderBottom:"1px solid var(--hm-border-glass)",className:"hm-glass-card",children:[e.jsxs(P,{spacing:1,align:"flex-start",children:[e.jsxs(d,{spacing:2,children:[e.jsx(u,{as:Ve,fontSize:"24px",color:"var(--hm-color-brand)"}),e.jsx(c,{fontSize:"xl",fontWeight:"700",color:"var(--hm-color-text-primary)",children:"HearMe Support"})]}),e.jsx(c,{fontSize:"sm",color:"var(--hm-color-text-secondary)",children:t("chat.header.anonConf")})]}),e.jsxs(Z,{children:[e.jsx(z,{label:t("chat.tooltips.languageSelect"),placement:"bottom",children:e.jsx(ee,{as:F,rightIcon:e.jsx(Re,{}),leftIcon:e.jsx(ye,{}),variant:"ghost",size:"sm",color:"var(--hm-color-text-primary)",_hover:{bg:"var(--hm-hover-bg)"},_active:{bg:"var(--hm-hover-bg)"},children:e.jsxs(d,{spacing:2,children:[e.jsx(c,{children:n.flag}),e.jsx(c,{display:{base:"none",md:"block"},children:n.name.split(" ")[0]})]})})}),e.jsx(ae,{bg:"var(--hm-bg-glass-strong)",backdropFilter:"blur(20px)",border:"1px solid var(--hm-border-glass)",maxH:"400px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"var(--hm-border-glass)",borderRadius:"10px"}},children:N.map(a=>e.jsx(_,{onClick:()=>re(a),bg:n.code===a.code?"var(--hm-hover-bg)":"transparent",_hover:{bg:"var(--hm-hover-bg)"},color:"var(--hm-color-text-primary)",children:e.jsxs(d,{spacing:3,w:"full",children:[e.jsx(c,{fontSize:"lg",children:a.flag}),e.jsx(c,{flex:"1",children:a.name}),n.code===a.code&&e.jsx(V,{colorScheme:"green",variant:"subtle",children:t("chat.badge.active")})]})},a.code))})]})]}),e.jsx(T,{direction:"column",flex:"1",overflowY:"auto",px:4,py:6,css:{"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"var(--hm-border-glass)",borderRadius:"10px"}},children:e.jsxs(P,{spacing:4,maxW:"900px",mx:"auto",w:"full",align:"stretch",children:[e.jsx(ke,{children:L.map((a,o)=>e.jsx(B,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},alignSelf:a.role==="user"?"flex-end":"flex-start",maxW:"75%",children:e.jsxs(u,{className:"hm-glass-card",px:5,py:3,borderRadius:"2xl",bg:a.role==="user"?"var(--hm-bg-glass-strong)":"var(--hm-bg-glass)",borderLeft:a.role==="assistant"?"3px solid var(--hm-color-brand)":"none",position:"relative",children:[a.role==="assistant"&&E&&o===L.length-1&&e.jsxs(d,{position:"absolute",top:2,right:2,spacing:1,bg:"var(--hm-color-brand)",px:2,py:1,borderRadius:"full",children:[e.jsx(W,{size:12,color:"white"}),e.jsx(c,{fontSize:"xs",color:"white",children:t("chat.status.speakingBadge")})]}),e.jsx(c,{fontSize:"md",color:"var(--hm-color-text-primary)",lineHeight:"1.6",whiteSpace:"pre-wrap",children:a.content}),e.jsxs(d,{justify:"space-between",mt:2,children:[e.jsx(c,{fontSize:"xs",color:"var(--hm-color-text-secondary)",children:new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),a.role==="assistant"&&x&&e.jsx(C,{icon:e.jsx(W,{}),size:"xs",variant:"ghost",color:"var(--hm-color-text-secondary)",_hover:{color:"var(--hm-color-brand)"},onClick:()=>Y(a.content),"aria-label":t("chat.aria.replay")})]})]})},o))}),H&&e.jsx(B,{initial:{opacity:0},animate:{opacity:1},alignSelf:"flex-start",maxW:"75%",children:e.jsx(u,{className:"hm-glass-card",px:5,py:3,borderRadius:"2xl",borderLeft:"3px solid var(--hm-color-brand)",children:e.jsxs(d,{spacing:2,children:[e.jsx(u,{w:"8px",h:"8px",borderRadius:"full",bg:"var(--hm-color-brand)",animation:"pulse 1.4s ease-in-out infinite"}),e.jsx(u,{w:"8px",h:"8px",borderRadius:"full",bg:"var(--hm-color-brand)",animation:"pulse 1.4s ease-in-out 0.2s infinite"}),e.jsx(u,{w:"8px",h:"8px",borderRadius:"full",bg:"var(--hm-color-brand)",animation:"pulse 1.4s ease-in-out 0.4s infinite"})]})})}),e.jsx("div",{ref:Q})]})}),$.length>0&&!H&&e.jsx(T,{px:4,pb:2,justify:"center",children:e.jsx(d,{spacing:2,flexWrap:"wrap",maxW:"900px",justify:"center",children:$.map((a,o)=>e.jsx(F,{size:"sm",variant:"outline",borderColor:"var(--hm-border-outline)",color:"var(--hm-color-text-primary)",borderRadius:"full",px:4,_hover:{bg:"var(--hm-hover-bg)",transform:"translateY(-2px)"},transition:"all 0.2s",onClick:()=>pe(a),children:a},o))})}),e.jsx(u,{px:4,py:4,borderTop:"1px solid var(--hm-border-glass)",className:"hm-glass-card",children:e.jsxs(P,{spacing:2,maxW:"900px",mx:"auto",children:[e.jsxs(d,{spacing:2,fontSize:"xs",color:"var(--hm-color-text-secondary)",alignSelf:"flex-start",children:[e.jsx(c,{children:n.flag}),e.jsx(c,{children:t("chat.status.speakingIn",{name:n.name})})]}),e.jsxs(d,{spacing:2,w:"full",children:[e.jsx(z,{label:t(x?"chat.tooltips.voiceToggleOn":"chat.tooltips.voiceToggleOff"),placement:"top",children:e.jsx(C,{icon:x?e.jsx(W,{}):e.jsx(Ne,{}),onClick:he,variant:"ghost",color:x?"var(--hm-color-brand)":"var(--hm-color-text-secondary)",_hover:{bg:"var(--hm-hover-bg)"},size:"lg","aria-label":t(x?"chat.aria.muteVoice":"chat.aria.enableVoice")})}),e.jsx(z,{label:t(l?"chat.tooltips.voiceInputOn":"chat.tooltips.voiceInputOff"),placement:"top",children:e.jsx(C,{icon:l?e.jsx(Le,{}):e.jsx(Ie,{}),onClick:l?le:ce,variant:"ghost",color:l?"red.500":"var(--hm-color-text-primary)",bg:l?"red.50":"transparent",_hover:{bg:l?"red.100":"var(--hm-hover-bg)"},size:"lg","aria-label":t(l?"chat.aria.stopListening":"chat.aria.startVoice"),animation:l?"pulse 1.5s ease-in-out infinite":"none"})}),e.jsxs(Z,{children:[e.jsx(z,{label:`TTS: ${w==="eleven"?"ElevenLabs":"Browser"}`,placement:"top",children:e.jsx(ee,{as:F,size:"sm",variant:"ghost",color:"var(--hm-color-text-primary)",_hover:{bg:"var(--hm-hover-bg)"},children:e.jsx(d,{spacing:2,children:e.jsx(c,{fontSize:"sm",children:w==="eleven"?"ElevenLabs":"Browser"})})})}),e.jsxs(ae,{bg:"var(--hm-bg-glass-strong)",backdropFilter:"blur(20px)",border:"1px solid var(--hm-border-glass)",children:[e.jsxs(_,{onClick:()=>X("eleven"),children:["ElevenLabs",w==="eleven"&&e.jsx(V,{ml:2,colorScheme:"green",variant:"subtle",children:"Active"})]}),e.jsxs(_,{onClick:()=>X("browser"),children:["Browser",w==="browser"&&e.jsx(V,{ml:2,colorScheme:"green",variant:"subtle",children:"Active"})]})]})]}),e.jsx(Be,{value:M,onChange:a=>U(a.target.value),onKeyDown:ge,placeholder:t(l?"chat.input.placeholderListening":"chat.input.placeholderIdle"),className:"hm-input",_focus:{borderColor:"var(--hm-color-brand)"},borderRadius:"full",size:"lg",fontSize:"md",disabled:A||!g||l,bg:"var(--hm-bg-glass)"}),e.jsx(C,{icon:A?e.jsx(Ee,{size:"sm"}):e.jsx(Te,{}),onClick:()=>D(),isDisabled:!M.trim()||A||!g||l,bgGradient:"var(--hm-gradient-cta)",_hover:{bgGradient:"var(--hm-gradient-cta-hover)",transform:"scale(1.05)"},_active:{transform:"scale(0.95)"},color:"white",borderRadius:"full",size:"lg","aria-label":t("chat.aria.send"),transition:"all 0.2s"})]}),(l||E)&&e.jsxs(d,{spacing:2,fontSize:"sm",color:"var(--hm-color-text-secondary)",children:[l&&e.jsxs(d,{spacing:1,children:[e.jsx(u,{w:"8px",h:"8px",borderRadius:"full",bg:"red.500",animation:"pulse 1s ease-in-out infinite"}),e.jsx(c,{children:t("chat.status.listening")})]}),E&&e.jsxs(d,{spacing:1,children:[e.jsx(u,{w:"8px",h:"8px",borderRadius:"full",bg:"var(--hm-color-brand)",animation:"pulse 1s ease-in-out infinite"}),e.jsx(c,{children:t("chat.status.aiSpeaking")})]})]})]})})]})]})};export{Fe as default};
